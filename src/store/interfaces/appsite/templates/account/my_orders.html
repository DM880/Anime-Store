{% extends 'base.html' %}
{% load static %}
{% load indexing %}
{% load mathfilters %}

{% block title %}My Orders{% endblock %}

{% block css %}<link rel="stylesheet" href="{% static 'css/account/my_orders.css' %}">{% endblock %}

{% block content %}

<div class="orders-wrapper">
    {% for order in completed_orders %}
    {% with index_count=index_count|add:forloop.counter0 %}
  <div class="order">
    <h2>Order id: {{ order.id }} </h2>
    <br>
    <h4>Time of purchase: {{ order.purchased }}</h4>
    <br>
     {% if forloop.counter0 >= 1 %}
    {% with start_index=count %}
    {% for item in items_list %}
    {% index index_count order_count as temp %}
    {% with count=count|add:temp %}
      {% if forloop.counter0 >= start_index %}
      {% if forloop.counter0 < count %}

    <div class="items-wrap">
      <div class="item-details"><h3>{{ item.name }}</h3><p>${{ item.price }}</p><img style="width:100px;height:100px;" src="/media/{{item.first_image.image}}">
      </div>
    </div>
    <br>
    {% endif %}
    {% endif %}
    {% endwith %}
    {% endfor %}
     {% endwith %}

    {% else %}
      {% for item in items_list %}
      {% if forloop.counter0 >= start_index %}
      {% if forloop.counter0 < count %}

    <div class="items-wrap">
      <div class="item-details"><h3>{{ item.name }}</h3><p>${{ item.price }}</p><img style="width:100px;height:100px;" src="/media/{{item.first_image.image}}">
      </div>
    </div>
    <br>
    {% endif %}
    {% endif %}
    {% endfor %}
    {% endif %}
    <h3>Tot price:</h3>
    <br>
    <h4>{{ order.tot_price }}</h4>
    <br>
  </div>
  <hr>
  {% endwith %}
  {% endfor %}
</div>

{% endblock %}